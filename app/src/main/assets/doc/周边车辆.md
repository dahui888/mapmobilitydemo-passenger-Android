#### 周边车辆SDK

周边车辆sdk是针对于出行场景（周边车辆）开发的SDK。该产品能够对召回的的周边车辆进行分类型展示，并提供车辆平滑移动的功能。

### 一、密钥申请

与腾讯地图key一致，如已申请，可直接使用。

### 二、配置文件

需要在AndroidMainfest文件中的<application/>节点下添加key。

```java
        <meta-data
            android:name="com.tencent.map.carpreview.api_key"
            android:value="用户申请key"
            />
```

在build gradle中依赖如下。

```java
    // 腾讯地图sdk
    implementation 'com.tencent.map:sdk-compat-v4:4.2.9'
    implementation 'com.tencent.map:tencent-map-vector-sdk:4.2.9'
    // 基础库
    implementation 'com.tencent.map:tencent-map-nav-surport:1.0.2.1'
    // 目前只支持aar方式，需配合地图版本4.2.9          
    implementation files('libs/tencentcarpreview_1.0.0.2.aar')
```

### 三、初始化

周边车辆sdk提供了TencentCarsMap来进行周边车辆展示。用户可通过mTencentCarsMap.getTencentMap()来获取内部的地图tencentMap。TencentCarsMap使用如下，其中map_top_ratio属性：屏幕中心点y的比例，距离屏幕上边距离:屏幕高。

```java
    <com.tencent.map.carpreview.ui.TencentCarsMap
        android:id="@+id/cars_map"
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        app:map_top_ratio="0.5" />
```
这是周边车辆sdk初始化的方法。

```java
	TencentCarsMap mTencentCarsMap = findViewById(R.id.cars_map);
        PreviewMapManager.init(this);
        PreviewMapManager previewMapManager = new PreviewMapManager();
```

### 四、参数配置

这是TencentCarsMap的方法列表。

|   方法名   |   含义   |
| ---- | ---- |
|   showPoiMaker()   |   显示默认大头针图标   |
|   hidePoiMaker()  |   隐藏默认大头针图标   |
|   clearCarsMarkers()  |   清除车辆的Marker   |

这是PreviewMapManager提供的方法列表，具体使用方法可参考demo。

|   方法名   |   含义   |
| ---- | ---- |
|   setKey(String key)   |   设置开放平台的Key（推荐在Mainfest中配置）   |
|   setCarsCount(int carsCount)   |   设置请求附近车数量，默认10   |
|   setRadius(int radius)    |   请求周边车辆范围，默认5000，单位米   |
|   setCity(int city)   |   设置城市编码，6位，如:110000(北京)   |
|   attachCarsMap(TencentCarsMap tencentMap)  |    绑定地图View   |
|   setCarsTypeResMap(HashMap<String, Integer> typeResMap)   |   设置车辆类型与车辆icon对应关系，icon是Res文件里的drawable id.   |
|   setCurrentLatLng(LatLng latLng)   |   移动地图中心点至latlng，并刷新数据   |
|   setCarsType(List<String> types)   |   设置车辆类型，需与setCarsTypeResMap对应，如1.出租车2.新能源3.舒适型4.豪华型5.商务型6.经济型   |
|   getNearbyCars(LatLng latLng)   |   刷新数据   |
|   setMock(boolean mock)   |   使用模拟数据，默认false   |
|   setWebServiceKey(String key, boolean isWebServiceKey)   |   设置签名校验方式，false:白名单，true:WebServiceAPI Key签名校验，默认false   |
|   startRefresh(int refreshTime)   |   数据刷新，并定时。如果refreshTime==0不刷新，单位s   |
|   stopRefresh()   |   停止刷新   |
|   isOpenLog(boolean isOpenLog)   |   debug模式下输出log   |
|   isNearCarShow(boolean isNearCarShow)   |   周边车辆展示开关，默认true   |
|   setTimeDelta(int timeDelta)   |   设置司机最后更新状态的时间间隔   |
|   registerNearbyCarsListener(INearbyListener callBack)   |   注册数据接口回调callBack   |
|   unregisterNearbyCarsListener(INearbyListener callBack)   |   取消回调callBack   |

### 五、混淆

在proguard-rules.pro中添加混淆代码。

```java
    # 地图
    -keep class com.tencent.tencentmap.**{*;}
    -keep class com.tencent.map.**{*;}
    -keep class com.tencent.beacontmap.**{*;}
    -keep class com.tencent.tencentmap.mapsdk.maps.BaseMapView{*;}
    -keep class navsns.**{*;}
    -dontwarn com.qq.**
    -dontwarn com.tencent.beacon.**
    # 周边车辆
    -keep class com.tencent.map.carpreview.**{*;}
```

